<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <title>「新しい相関係数」をわかった気になるためのコピュラ入門</title>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>ISSEY SUKEDA</title>
<meta name="description" content="Issey&#39;s Portfolio site">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://stardust-coder.github.io/myportfolio/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="https://stardust-coder.github.io/myportfolio/css/font-awesome.min.css">
<link rel="stylesheet" href="https://stardust-coder.github.io/myportfolio/css/owl.carousel.css">
<link rel="stylesheet" href="https://stardust-coder.github.io/myportfolio/css/owl.theme.css">


  <link href="https://stardust-coder.github.io/myportfolio/css/style.green.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="https://stardust-coder.github.io/myportfolio/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="https://stardust-coder.github.io/myportfolio/img/favicon.png">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-256435997-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
</head>

<body>
    <div id="all">
        <div class="container-fluid">
            <div class="row row-offcanvas row-offcanvas-left">
                <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <h1 class="sidebar-heading"><a href="https://stardust-coder.github.io/myportfolio/">ISSEY SUKEDA</a></h1>
    
      <p class="sidebar-p">I am an applied mathematics researcher and an amateur juggler with more than 10 years of experience.</p>
    
      <p class="sidebar-p">Originally from Singapore, currently based in Tokyo.</p>
    
    <ul class="sidebar-menu">
      
        <li><a href="https://stardust-coder.github.io/myportfolio/portfolio/">Home</a></li>
      
        <li><a href="https://stardust-coder.github.io/myportfolio/about/english">Profile</a></li>
      
        <li><a href="https://stardust-coder.github.io/myportfolio/page/publication">Publication</a></li>
      
        <li><a href="https://stardust-coder.github.io/myportfolio/page/bookmark">Bookmark</a></li>
      
        <li><a href="https://stardust-coder.github.io/myportfolio/about/japanese">Japanese</a></li>
      
    </ul>
    <p class="social">
  
  
  
  
  
  
  <a href="https://jp.linkedin.com/in/stardust11" data-animate-hover="pulse" class="external" title="LinkedIn">
    <i class="fa fa-linkedin"></i>
  </a>
  
  
  
  <a href="https://github.com/stardust-coder" data-animate-hover="pulse" class="external" title="GitHub">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2022 Issey Sukeda |
        
        Template by <a href="https://bootstrapious.com/free-templates" class="external">Bootstrapious.com</a>

&amp; ported to Hugo by <a href="https://github.com/kishaningithub">Kishan B</a>

      </p>
    </div>
  </div>
</div>

                
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="https://stardust-coder.github.io/myportfolio/">ISSEY SUKEDA</a></h1>
</div>

  <div class="row">
    <div class="col-lg-12">
      <div class="content-column-content">
        <h1>「新しい相関係数」をわかった気になるためのコピュラ入門</h1>
        <p>「新しい相関係数」こと、<strong>Chatterjee correlation</strong>の紹介記事がXで話題を呼んでいると耳にしたので、流行に乗って補足の解説記事を書いてみます。</p>
<p><strong>話題の記事</strong></p>
<ul>
<li><a href="https://qiita.com/Islay_tr/items/dd427ba86ba11bd25626">「新しい相関係数」について</a></li>
<li><a href="https://zenn.dev/falconnnmmm/articles/4eecd8a5c3253a">新しい相関係数の理論的性質</a></li>
</ul>
<p><strong>関連論文</strong></p>
<ul>
<li><a href="https://www.tandfonline.com/doi/full/10.1080/01621459.2020.1758115">A new coefficent of correlation</a>
<ul>
<li>当該相関係数は、2019年にChatterjee教授によって提案され, 論文は2021年に統計学四大誌の１つJASAに採録されました。</li>
</ul>
</li>
<li><a href="https://arxiv.org/abs/2211.04702">A survey of recent developments in measures of association</a>
<ul>
<li>著者ご本人がChatterjee correlationとその周辺・拡張をまとめ直した論文です。</li>
</ul>
</li>
<li><a href="https://arxiv.org/abs/2506.15897">The exact region and an inequality between Chatterjee&rsquo;s and Spearman&rsquo;s rank correlations</a>
<ul>
<li>Chatterjee correlationとSpearmanのρの関係性を調べた最近の論文です。前者は後者より大幅に小さい値を取りがちで、その幅は最大で0.4だと主張されています。おもしろい。</li>
</ul>
</li>
</ul>
<h1 id="新しい相関係数ことchatterjee-correlationとは">「新しい相関係数」こと、Chatterjee correlationとは？</h1>
<p>まず初めにデータは$X$の小さい順に並べ替えておきます。
データ${(X_i,Y_i)}_{i=1}^n$ がある時、XとYのChatterjee相関は以下のように計算されます。
ただし簡単のため、本記事では以下タイ（同じ値を取っているデータが複数存在する事）は存在しないものとします。</p>
<p>$$
\xi_n(X,Y) = 1 - \frac{3 \sum_{i=1}^{n-1} |r_{i+1} - r_i|}{n^2-1}
$$</p>
<p>ここで$r_i$は$Y_i$の順位（rank）を表します。</p>
<p><strong>特徴</strong></p>
<ol>
<li>順位のみから決まります。いわゆる<strong>順位相関係数</strong>というやつです。
<ul>
<li>「スケーリングに影響されにくい」「外れ値にロバスト」等と巷で述べられているものの背景はこの点に集約されます。</li>
<li>スピアマンやケンドールもそうです。ピアソンは違います。</li>
</ul>
</li>
<li>非対称です。$\xi_n(X,Y) \neq \xi_n(Y,X)$
<ul>
<li>$(X,Y)$が同時に生じやすいという相関よりも, $X$で$Y$が説明できるかという回帰のイメージに近い</li>
<li>上記の平均やmaxをとれば対称化することも一応可能。</li>
</ul>
</li>
<li>有限の$n$では$-\frac{1}{2}+O(\frac{1}{n})$ 〜 $\frac{n-2}{n+1}$の値を取る事が示されています。</li>
<li>i.i.d.仮定の下、データ数$n$が十分に大きい極限では以下の値 $\xi$ に収束します。こちらは定義から明らかに0から1の範囲の値を取ります。
<ul>
<li>上限値は良いとして、下限値は$-\frac{1}{2}$ではないのかと気になるところですね。$\xi_n$が明らかな負の値を取ったときの解釈は「i.i.d.とはかけ離れてるデータだ」ということになると述べられています。[Chatterjee, JASA,2021]
$$
\xi(X,Y) = \frac{\int \mathrm{Var}(\mathbb{E}[1_{Y \geq t}\mid X]) d\mu(t)}{\int \mathrm{Var}(1_{Y \geq t}) d\mu(t)}
$$</li>
</ul>
</li>
</ol>
<h1 id="ここでいきなりコピュラを導入します">ここでいきなりコピュラを導入します</h1>
<p>$\xi$の意味への理解を深めるため、ここでいきなりコピュラというものを導入したいと思います。</p>
<h2 id="コピュラとは何か">コピュラとは何か</h2>
<p>今、XとYの相関を測ることを考えていますね。コピュラとは何かを簡単に述べると、&ldquo;XとYの従属性に関する情報のみを残した&quot;部分です。
言い方を変えると、&ldquo;XとYの（同時）分布から、相関構造に関係しない要素を排除した残り物&quot;です。
では、「相関構造に関係しない」とはどういう意味でしょうか？ここでは <strong>「Xにしか依存しない要素」「Yにしか依存しない要素」は（片方の変数にしか左右されないのだから）相関じゃないよね</strong> 、という立場に立ちます。（★）</p>
<p>「（データの）相関を見たければ（その分布の）コピュラだけに注目すれば良い！」と言っても実は過言ではありません。</p>
<h2 id="コピュラを得る手続き">コピュラを得る手続き</h2>
<p>お手元の二変数のデータ${(X_i,Y_i)}_{i=1}^n$ からコピュラを得る方法を天下り的に説明します。</p>
<p>まず $[0,1]^2$ という正方形領域を用意します。
そしたら、X側を、順位を変えないように均等に並べます。
その後、Y側を、順位を変えないように均等に並べます。
これで完成です！</p>
<p>この操作の真意は「順位を保っている限りは相関構造は全く変化しないよね」「あらゆるデータを単位正方形上に移してやると統一的に議論（従属性の強さを測ったり）ができていいよね」の２点です。</p>
<p>右側の図を見ていただくと、コピュラ自身が $[0,1]^2$ 上の分布となっていることがわかります。この点も、数学的な扱いの上で都合が良いのです。</p>
<h2 id="数式での理解">数式での理解</h2>
<p>上記の変換は数式上は以下のように整理されます。（周辺分布が絶対連続の場合の説明です。）</p>
<p>$$f_{XY}(x,y) = f_X(x) f_Y(y) c(F_X(x), F_Y(y))$$</p>
<p>小文字が密度関数、大文字が累積分布関数です。
元の同時分布 $f_{XY}$ から周辺分布 $f_X / F_X$と$f_Y/F_Y$ が決まり、そこから右辺の$c$という関数形が決まるという流れが分かりやすいかと思います。この$c$が <strong>コピュラ（密度）</strong> と呼ばれています。<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p>すなわち前節の順位を使って並べ替える操作でやりたかったのは、$x \to F_X(x)$, $y \to F_Y(y)$ という変数変換なのでした。<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<p>$F_X$と$F_Y$はそれぞれ分布関数なので、$(x,y)$はちゃんと $[0,1]^2$上に移っていますね。そして右辺の$f_X$, $f_Y$はそれぞれのヤコビアンとして現れています。</p>
<p>前に述べた（★）の立場は、この定式化を使うと情報理論的な視点からも考えられます。
分布$f$のShannonエントロピーは $\int -f\log{f} d\mu$です。よって、$u=F_X(x), v=F_Y(y)$と置くと、以下の分解が成立します。
$$
-\int f_{XY} \log{f_{XY}} dxdy = -\int f_{X} \log{f_{X}} dx -\int f_{Y} \log{f_{Y}} dy -\int c \log{c}\ dudv
$$</p>
<p>すなわち$(X,Y)$が持つ&quot;情報&quot;から、右辺第１項「Xにしか依存しない要素」と右辺第２項「Yにしか依存しない要素」を除去した残り物である第３項が従属性に関する情報であり、それはコピュラ$c$にのみ依存しています。</p>
<h1 id="chatterjee-correlationをコピュラで書き直します">Chatterjee correlationをコピュラで書き直します</h1>
<p>いよいよ本題です。</p>
<h2 id="1つめの表式">1つめの表式</h2>
<p>（$X$, $Y$の周辺分布が連続であるという仮定の下、）Chatterjee相関$(n\to\infty)$は以下のように書くこともできます。 [Ansari and Rockel, arXiv, 2025]</p>
<p>$$
\xi = 6\int_0^1 \int_0^1 \left( \frac{\partial C}{\partial t} (t,v)\right)^2 dtdv - 2
$$</p>
<p>順位相関係数はその名の通り順位を使って計算するのですが、その意味を少し考えると、コピュラのみから決まることもわかると思います。
特徴1で述べたようにChatterjee相関は順位相関係数の１つなので案の定コピュラ$C$のみから決まっていることが見て取れると思います。頭の６倍や最後の-2は[0,1]に収めるための調整項です。</p>
<p>その中でも特にChatterjee相関はコピュラ（分布関数）$C(u,v)$ の$u$での偏微分 $\frac{\partial C}{\partial u}$を測っているようですね。この値は理解しづらいですが、元の確率変数で言えば、$X$を既知としたときの$Y$の条件付き分布に相当します。</p>
<p>さてここからさらに直感的なイメージがつきやすい形に変形していきましょう。</p>
<h2 id="2つ目の表式">2つ目の表式</h2>
<p>この表式への変形は容易ですね。
$$
\xi = 6\int_0^1 \int_0^1  \left( \frac{\partial C}{\partial t} (t,v) ^2- v^2 \right) dtdv
$$</p>
<p>$X$と$Y$が独立な時、コピュラは$C(u,v)=uv$なので、$\frac{\partial C}{\partial u} (t,v) = v$となります。そのためこの表式にすると、$\frac{\partial C}{\partial t} (t,v)$と $v$ の乖離を測っている、すなわち独立の場合とどれ程離れているかを計算していることが見えやすくなりました。</p>
<p>このように$\frac{\partial C}{\partial u}$と$v$の乖離を測っていることが分かると、素朴な疑問が湧きます。何故それぞれの２乗を取った差分を計算しているのでしょうか？代わりに違う差分を使えば新たな相関指標が構築できるかもしれません！例えば愚直な差分
$\int_0^1 \int_0^1  \left( \frac{\partial C}{\partial t} (t,v) - v \right) dtdv$ としてみると、これは常に0になってしまいNGです。一方で差の絶対値を取り、$\int_0^1 \int_0^1  \left| \frac{\partial C}{\partial t} (t,v) - v \right| dtdv$ としてみるどうでしょうか？この要領でChatterjee相関の亜種が作れるかもしれません。 <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
<h2 id="３つ目の表式">３つ目の表式</h2>
<p>最後に密度関数での表示を検討します。</p>
<p>$$
\xi = 6\int_0^1 \int_0^1  \left( \int_0^v c(t,s_1)ds_1\right) \left( \int_0^v c(t,s_2)ds_2\right) dtdv -2
$$</p>
<p>$$
= 6 \int_0^1 \int_0^1 \int_0^1 (1-\max{(s_1,s_2)}) c(t,s_1) c(t,s_2) dt ds_1 ds_2 - 2
$$</p>
<p>$$
= 6 { \mathbb{E}<em>{p</em>{cond}}[1-\max{(s_1,s_2)}] - \mathbb{E}<em>{p</em>{uniform}}[1-\max{(s_1,s_2)}]}
$$</p>
<p>つまり$U=t$で&quot;縦&quot;に切られたコピュラ密度関数から、$s_1$と$s_2$という２つのサンプルを取ってみて、$1-\max{(s_1,s_2)}$が取る値の期待値を計算しています。この$1-\max{(s_1,s_2)}$の直感的意味は、</p>
<p>「同じ条件 $U=t$ のもとで2回引くと、どれだけ一緒に下側に寄るか」</p>
<p>です。$\xi$の表式に戻ると、第１項が同じ$U=t$を共有するときに同じ条件付き分布から$s_1, s_2$を引いた場合（その同時密度は$p_{cond}(s_1,s_2) = \int_0^1 c(t,s_1)c(t,s_2) dt$）で、第２項が$p_{cond}$がもしも一様だった場合（そのとき同時密度は一様$p_{uniform}(s_1,s_2) = 1$）に相当しますので、やはり従属性が全くなかった場合との乖離を測る形になっています。</p>
<h1 id="まとめ">まとめ</h1>
<ul>
<li>$(X,Y)$の相関（含む従属構造）を正方形領域$[0,1]^2$上の$(U,V)$に変換して、コピュラを通して見る方法を紹介しました。</li>
<li>話題のChatterjee相関の異なる表式をコピュラを通して３種類紹介しました。
<ul>
<li>コピュラの第一変数による一階偏微分（もしくはコピュラ密度の第二変数に関する積分）が鍵を握っており、この点が従来の$XY$間の対称性を有する順位相関（スピアマンやケンドール等）と決定的に違いました。</li>
</ul>
</li>
<li>Chatterjee相関の意味合いを数式を一切使わずに述べると、強いて言えば</li>
</ul>
<p>「同じ$X/U$の値をとったという条件のもとで２回$Y/V$を引くと、それらがどれだけ一緒に下側/0側に寄るか」というある種の連動度が、仮に完全に独立（無相関）だった場合と比べて相対的にどれ程大きいのか？」を期待値の意味で測っている</p>
<p>となるでしょうか。</p>
<h1 id="おわりに">おわりに</h1>
<ul>
<li>分量としては少なめになりますが、Chatterjee correlationの直感的理解の一助になれば幸いです。</li>
<li>内容に誤り等ありましたらコメントにてご指摘ください。</li>
</ul>
<h1 id="参考文献">参考文献</h1>
<p>Sourav Chatterjee. A new coefficient of correlation. J. Am. Stat. Assoc., 116(536):2009–2022, 2021.</p>
<p>Sourav Chatterjee. A survey of some recent developments in measures of association. InProbability and Stochastic Processes. A volume in honour of Rajeeva L. Karandikar, pages
109–128. Singpore: Springer, 2024.</p>
<p>Jonathan Ansari,  Marcus Rockel. The exact region and an inequality between Chatterjee’s and Spearman’s rank correlations. arXiv e-print., 2025.</p>
<p>また追加で、コピュラ統計学に興味を持った方向けにおすすめの文献を貼っておきます。</p>
<ul>
<li><a href="https://link.springer.com/book/10.1007/0-387-28678-0">Introduction to copulas (Nelsen, 2007)</a>
<ul>
<li>不動の教科書</li>
</ul>
</li>
<li><a href="https://www.uni-muenster.de/Physik.TP/~lemm/seminarSS08/JHE-2007.pdf">Everything You Always Wanted to Know about Copula Modeling but Were Afraid to Ask (Genest and Favre, 2007)</a>
<ul>
<li>読みやすいです</li>
</ul>
</li>
<li><a href="https://www.jarip.org/report/2008/seminar_20090225_slides.pdf">コピュラの金融実務での活用 (吉羽要直, 2009)</a>
<ul>
<li>金融実務でのコピュラの活躍を垣間見れるスライドです。</li>
</ul>
</li>
</ul>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>本当は定義の順番が違い、累積分布関数側から定義されます。$[0,1]^2$上の関数$C$の端点での値と2-increasingという性質から定義がなされます。&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>ただ分布関数を使った変数変換なのですが、「確率積分変換」という格好いい名称がついています。&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>私が調べた限りではこのような定義のものは見当たりませんでした。が、いかにもありそうな形です。&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
        
      </div>
    </div>
  </div>
</div>

            </div>
        </div>
    </div>
    <script src="https://stardust-coder.github.io/myportfolio/js/jquery.min.js"></script>
<script src="https://stardust-coder.github.io/myportfolio/js/bootstrap.min.js"></script>
<script src="https://stardust-coder.github.io/myportfolio/js/jquery.cookie.js"> </script>
<script src="https://stardust-coder.github.io/myportfolio/js/ekko-lightbox.js"></script>
<script src="https://stardust-coder.github.io/myportfolio/js/jquery.scrollTo.min.js"></script>
<script src="https://stardust-coder.github.io/myportfolio/js/masonry.pkgd.min.js"></script>
<script src="https://stardust-coder.github.io/myportfolio/js/imagesloaded.pkgd.min.js"></script>
<script src="https://stardust-coder.github.io/myportfolio/js/owl.carousel.min.js"></script>
<script src="https://stardust-coder.github.io/myportfolio/js/front.js"></script>



</body>

</html>